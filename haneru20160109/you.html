<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="./img/favicon.ico">
    <script src="http://code.jquery.com/jquery-latest.js" type="text/javascript" charset="utf-8"></script>
    <script src="./js/jquery.tagcloud.js" charset="utf-8"></script>
    <script src="./js/js.cookie.js" charset="utf-8"></script>

    <!-- Bootstrap core CSS -->
    <link href="./css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="./css/starter-template.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-70604621-1', 'auto');
      ga('send', 'pageview');

    </script>

        <title>非公式マヨイガの里ダイジェスト| イベント
        </title>


  </head>
  <body>
      <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <span class="navbar-brand">非公式マヨイガの里・瓦版</span>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
          <li><a href="index.html">Home<span class="glyphicon glyphicon-home"></span></a></li><li><a href="media.html">絵巻一覧<span class="glyphicon glyphicon-picture"></span></a></li><li><a href="tagcloud.html">１日の話題<span class="glyphicon glyphicon-comment"></span></a></li> <li class="active"><a href="you.html">イベント<span class="glyphicon glyphicon-asterisk"></span></a></li><li><a href="about.html">参考ページ<span class="glyphicon glyphicon-th-list"></span></a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container show-grid">
        <div class="text-center">
            <h1>九十九様に徳印を送る</h1>
            <p><img src="./img/love.png"></p>
            <h2><span id="current_sum"></span>/<small>10000</small></h2>

                <button type="button" class="btn btn-default btn-lg" id="counterButton">
                  <span class="glyphicon glyphicon-asterisk" aria-hidden="true" id="counter"> 徳印を渡す</span>
                </button>
                <p><span id="current_time"></span><br />5分に1回特印を送ることが可能です。</p>
        </div>
              <script>
              var MyIP;
              function getMyIP(data){
                  MyIP = data.ip;
                  $('#myip').text(MyIP);
              }
              $.getJSON('http://jsonip.com/', getMyIP);

              function currentTime(){
                  var now = new Date();
                  var d = now.getDate();
                  var h = now.getHours();
                  var m = now.getMinutes();
                  var s = now.getSeconds();
                  return "1月" + d + "日" + h + "時" + m + "分";
              }
              function getCount(){
                  $.get("http://code.mayoiga.popowa.com/cgi-bin/get-count.py", function(data){
                      $('#current_sum').text(data.count);
                    });
              }

              $( document ).ready(function() {
                  getCount();
              });
              if (typeof Cookies.get('MayoigaVote')  === "undefined"){
                  $('#current_time').text('徳印を送りましょう！');
                  $(':button').prop("disabled", false);
              }　else {
                  $('#current_time').text('徳印を' + Cookies.get('MayoigaVote') + 'に送りました。');
                  $(':button').prop("disabled", true);
              }
              $('span#counter').on({
                  'click': function(){
                      if($(':button').prop('disabled',false) && typeof Cookies.get('MayoigaVote') === "undefined"){
                          $(':button').prop("disabled", true);
                          var IP = $('#myip').text();
                          $.post("http://code.mayoiga.popowa.com/cgi-bin/counter.py",
                                {ip: IP, time:$.now()},
                                function(data){
                                    var date = new Date();
                                    date.setTime(date.getTime() + (60 * 1000 * 5));
                                    var current_time = currentTime();
                                    Cookies.set('MayoigaVote', current_time, { expires: date });
                                    $('#current_time').text('徳印を' + current_time+ 'に送りました。');
                                    getCount();
                                }
                            )
                      } else {
                          $(':button').prop("disabled", true);
                      }

                }
            });
    </script>
        <footer class="text-center">コンテンツ内容は、マヨイガの里に参加しているユーザーに属します。
            <br />不正をしているユーザーはIPブロックし投票を無効にします。</footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="./js/bootstrap.min.js"></script>
    <!--<script src="./js/masonry.pkgd.min.js" charset="utf-8"></script>-->

  </body>
</html>
